extends ../layout_admin

block content
    .row
        include ./sidebar_admin
        .col.s8
            .row
                if messages.info
                    script(type='text/javascript').
                        Materialize.toast('info', 4000)

                form.col.s12(name="textInf")
                    .row
                        .input-field.col.s12
                            input#book_title(type='text', name='book_title')
                            label(for='title') Название
                    .row
                        .input-field.col.s8
                            input#book_author(type='text', name='book_author')
                            label(for='book_author') Автор

                        .input-field.col.s4
                            input#book_isbn(type='text', name='book_isbn')
                            label(for='book_isbn') ISBN

                    .row
                        .input-field.col.s4
                                select#book_type(name='book_type')
                                    option(value='нет', disabled selected) Выбрать тип
                                    option(value='Монография') Монография
                                    option(value='Научная статья') Научная статья
                                    option(value='Методичка') Методичка
                                label Тип
                        .input-field.col.s4
                            input#year_pub(type='text', name='year_pub')
                            label(for='title') Введите год издания
                        .input-field.col.s4
                                select#book_lang(name='book_lang')
                                    option(value='нет', disabled selected) Выбрать язык книги
                                    option(value='Кыргызский') Кыргызский
                                    option(value='Русский') Русский
                                    option(value='English') English
                                label Язык книги

                    .row
                        .input-field.col.s6
                            input#book_photo(type='text', name='book_photo')
                            label(for='book_photo') Ссылка обложки
                        .input-field.col.s6
                            input#book_link(type='text', name='book_link')
                            label(for='book_link') Ссылка на файл

                    .row
                        .col.s12
                                input(type="submit", value="Сохранить", class="btn btn-success")

        script.
            $(document.forms['textInf']).on('submit', function () {
                var form = $(this);
                $('.error', form).html('');
                $(":submit", form).text("loading");
                $.ajax({
                    url: "/book/add",
                    method: "POST",
                    data: form.serialize(),
                    complete: function () {
                        $(":submit", form).text("Добавить");
                    },
                    statusCode: {
                        200: function () {
                            form.html("Данные успешно добавлены").addClass('alert-success');
                            window.location.href = "/book";
                        },
                        403: function (jqXHR) {
                            var error = JSON.parse(jqXHR.responseText);
                            $('.error', form).html(error.message);
                        }
                    }
                });
                return false;
            });